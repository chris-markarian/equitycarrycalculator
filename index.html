<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Underwriting Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0f1a;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --bg-input: #0d1421;
            --accent-teal: #14b8a6;
            --accent-teal-dim: #0d9488;
            --accent-amber: #f59e0b;
            --accent-red: #ef4444;
            --accent-green: #22c55e;
            --accent-blue: #3b82f6;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #2d3a4f;
            --input-border: #3d4f6a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .info-bar {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .info-row-full {
            width: 100%;
        }

        .info-row-full .info-section {
            width: 100%;
        }

        /* Sticky Dashboard Bar */
        .sticky-dashboard {
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .dashboard-metric {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
        }

        .dashboard-label {
            font-size: 0.7rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .dashboard-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #14b8a6;
        }

        .dashboard-value.negative {
            color: #f87171;
        }

        .dashboard-value.positive {
            color: #4ade80;
        }

        @media (max-width: 900px) {
            .sticky-dashboard {
                justify-content: center;
                padding: 0.75rem 1rem;
            }
            
            .dashboard-metric {
                min-width: 80px;
            }
            
            .dashboard-value {
                font-size: 1rem;
            }
        }

        @media (max-width: 600px) {
            .sticky-dashboard {
                position: relative;
                top: auto;
            }
        }

        @media (max-width: 900px) {
            .info-bar {
                gap: 1rem;
            }
        }

        .info-section-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-input {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-input);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'DM Sans', sans-serif;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .info-input:focus {
            outline: none;
            border-color: var(--accent-teal);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.15);
        }

        .info-input::placeholder {
            color: var(--text-muted);
        }

        .info-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }

        @media (max-width: 700px) {
            .info-row {
                grid-template-columns: 1fr;
            }
        }

        /* Market Analysis Styles */
        .market-analysis-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .market-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .market-header-left {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .generate-prompt-btn {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-blue));
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .generate-prompt-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(20, 184, 166, 0.4);
        }

        .prompt-section {
            margin-top: 0.5rem;
        }

        .prompt-instructions {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .prompt-output-container {
            margin-top: 1rem;
        }

        .prompt-output {
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1.25rem;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            color: var(--text-secondary);
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .copy-btn {
            background: var(--accent-teal);
            border: none;
            color: white;
            padding: 0.6rem 1.25rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .copy-btn:hover {
            background: var(--accent-teal-dim);
        }

        .copy-btn.copied {
            background: var(--accent-green);
        }

        .prompt-tip {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--accent-blue);
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--accent-blue);
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 1400px) {
            .main-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .icon-teal { background: rgba(20, 184, 166, 0.15); color: var(--accent-teal); }
        .icon-amber { background: rgba(245, 158, 11, 0.15); color: var(--accent-amber); }
        .icon-blue { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .icon-green { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .icon-red { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.4rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-input);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'Space Mono', monospace;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-teal);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.15);
        }

        input.input-highlight {
            border-color: var(--accent-teal);
            background: rgba(20, 184, 166, 0.05);
        }

        input.input-target {
            border-color: #f59e0b !important;
            background: rgba(245, 158, 11, 0.1) !important;
        }

        input.input-target::placeholder {
            color: #9ca3af;
            font-style: italic;
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394a3b8'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.25rem;
            padding-right: 2.5rem;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .result-item {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .result-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .result-value {
            font-family: 'Space Mono', monospace;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .result-value.positive { color: var(--accent-green); }
        .result-value.negative { color: var(--accent-red); }
        .result-value.highlight { color: var(--accent-teal); }
        .result-value.amber { color: var(--accent-amber); }

        .result-item.full-width {
            grid-column: span 2;
        }

        .section-divider {
            height: 1px;
            background: var(--border-color);
            margin: 1.25rem 0;
        }

        .mini-label {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .summary-card {
            grid-column: span 1;
        }

        .summary-card .result-grid {
            grid-template-columns: 1fr;
        }

        .loi-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.5rem;
        }

        .loi-table td {
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        .loi-table td:first-child {
            color: var(--text-secondary);
        }

        .loi-table td:last-child {
            text-align: right;
            font-family: 'Space Mono', monospace;
            font-weight: 600;
            color: var(--text-primary);
        }

        .loi-table tr:last-child td {
            border-bottom: none;
        }

        .spread-indicator {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .spread-indicator.positive {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }

        .spread-indicator.negative {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }

        .spread-indicator.neutral {
            background: rgba(245, 158, 11, 0.15);
            color: var(--accent-amber);
            border: 1px solid var(--accent-amber);
        }

        .spread-icon {
            font-size: 1rem;
        }

        .cash-breakdown {
            background: linear-gradient(135deg, rgba(20, 184, 166, 0.1), rgba(59, 130, 246, 0.1));
            border: 1px solid var(--accent-teal);
            padding: 1.25rem;
            border-radius: 12px;
            margin-top: 1rem;
        }

        .cash-breakdown-title {
            font-size: 0.8rem;
            color: var(--accent-teal);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .expense-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9rem;
        }

        .expense-row:not(:last-child) {
            border-bottom: 1px dashed var(--border-color);
        }

        .expense-label {
            color: var(--text-secondary);
        }

        .expense-value {
            font-family: 'Space Mono', monospace;
            color: var(--text-primary);
        }

        .total-row {
            margin-top: 0.5rem;
            padding-top: 0.75rem;
            border-top: 2px solid var(--accent-teal);
            font-weight: 700;
        }

        .total-row .expense-value {
            color: var(--accent-teal);
            font-size: 1.1rem;
        }

        .helper-text {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-success { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .badge-warning { background: rgba(245, 158, 11, 0.15); color: var(--accent-amber); }
        .badge-danger { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }

        .percentage-inputs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .percentage-inputs .form-group {
            margin-bottom: 0.5rem;
        }

        .card.wide {
            grid-column: span 2;
        }

        @media (max-width: 900px) {
            .card.wide {
                grid-column: span 1;
            }
        }

        footer {
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .print-btn {
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-blue));
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 20px rgba(20, 184, 166, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
        }

        .print-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(20, 184, 166, 0.5);
        }

        .excel-btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
        }

        .excel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(34, 197, 94, 0.5);
        }

        .loi-btn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
        }

        .loi-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(245, 158, 11, 0.5);
        }

        .export-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .save-btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(139, 92, 246, 0.5);
        }

        .load-btn {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
        }

        .load-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.5);
        }

        /* PDF Summary Styles */
        #pdf-summary {
            display: none;
        }

        @media print {
            body {
                background: white;
                margin: 0;
                padding: 0;
            }
            
            body > * {
                display: none !important;
            }
            
            #pdf-summary.printing {
                display: block !important;
                position: relative;
                width: 100%;
                background: white;
                color: #1a1a1a;
                padding: 20px 40px;
                font-family: 'DM Sans', Arial, sans-serif;
                margin: 0;
            }

            #loi-document.printing {
                display: block !important;
                position: relative;
                width: 100%;
                background: white;
                margin: 0;
            }

            .print-btn, .excel-btn, .loi-btn {
                display: none !important;
            }

            .container, .main-grid, .card, header, footer, .info-bar, .market-analysis-section, .export-buttons, .sticky-dashboard {
                display: none !important;
            }

            .pdf-two-col {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }

            .pdf-section {
                page-break-inside: avoid;
                margin-bottom: 15px;
            }

            .pdf-highlight-box {
                page-break-inside: avoid;
            }

            .loi-signature-section {
                page-break-inside: avoid;
            }
        }

        #pdf-summary {
            background: white;
            color: #1a1a1a;
            padding: 40px;
            font-family: 'DM Sans', Arial, sans-serif;
        }

        .pdf-header {
            text-align: center;
            border-bottom: 3px solid #14b8a6;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .pdf-header h1 {
            font-size: 28px;
            color: #1a1a1a;
            margin-bottom: 5px;
            background: none;
            -webkit-text-fill-color: #1a1a1a;
        }

        .pdf-header .pdf-subtitle {
            color: #666;
            font-size: 14px;
        }

        .pdf-header .pdf-date {
            color: #888;
            font-size: 12px;
            margin-top: 10px;
        }

        .pdf-header .pdf-address {
            font-size: 18px;
            color: #333;
            font-weight: 600;
            margin-top: 8px;
        }

        .pdf-header .pdf-property-link {
            font-size: 11px;
            margin-top: 5px;
        }

        .pdf-header .pdf-property-link a {
            color: #14b8a6;
            text-decoration: none;
        }

        .pdf-preparer-box {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pdf-preparer-title {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pdf-preparer-info {
            text-align: right;
        }

        .pdf-preparer-info span {
            display: block;
        }

        #pdf-preparer-name {
            font-weight: 600;
            color: #1a1a1a;
            font-size: 14px;
        }

        #pdf-preparer-contact {
            color: #666;
            font-size: 12px;
            margin-top: 3px;
        }

        .pdf-section {
            margin-bottom: 25px;
            page-break-inside: avoid;
        }

        .pdf-section-title {
            font-size: 16px;
            font-weight: 700;
            color: #14b8a6;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 8px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pdf-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .pdf-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dotted #e0e0e0;
        }

        .pdf-row:last-child {
            border-bottom: none;
        }

        .pdf-label {
            color: #555;
            font-size: 13px;
        }

        .pdf-value {
            font-weight: 600;
            color: #1a1a1a;
            font-family: 'Space Mono', monospace;
            font-size: 13px;
        }

        .pdf-value.positive { color: #16a34a; }
        .pdf-value.negative { color: #dc2626; }
        .pdf-value.highlight { color: #0d9488; }

        .pdf-highlight-box {
            background: #f0fdfa;
            border: 2px solid #14b8a6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            text-align: center;
        }

        .pdf-highlight-item h3 {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .pdf-highlight-item .value {
            font-size: 20px;
            font-weight: 700;
            color: #0d9488;
            font-family: 'Space Mono', monospace;
        }

        .pdf-two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .pdf-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            color: #888;
            font-size: 11px;
        }

        /* LOI Document Styles */
        #loi-document {
            display: none;
            background: white;
            color: #1a1a1a;
            padding: 40px 50px;
            font-family: Arial, sans-serif;
            font-size: 11pt;
            line-height: 1.5;
            max-width: 8.5in;
            margin: 0 auto;
        }

        .loi-date-header {
            margin-bottom: 20px;
            font-size: 11pt;
        }

        .loi-address-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .loi-property-link {
            font-size: 10pt;
            margin-bottom: 15px;
        }

        .loi-property-link a {
            color: #0066cc;
            text-decoration: none;
        }

        .loi-tracking {
            font-weight: normal;
        }

        .loi-re {
            margin-bottom: 20px;
        }

        .loi-greeting {
            margin-bottom: 20px;
        }

        .loi-body {
            text-align: justify;
        }

        .loi-body h3 {
            font-size: 11pt;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .loi-body p {
            margin-bottom: 12px;
        }

        .loi-body ul {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .loi-body li {
            margin-bottom: 6px;
        }

        .loi-steps-box {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
        }

        .loi-steps-box h3 {
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 11pt;
        }

        .loi-steps-box h3:first-child {
            margin-top: 0;
        }

        .loi-steps-box ul {
            margin-left: 20px;
            margin-bottom: 0;
        }

        .loi-benefits li {
            list-style: none;
            margin-left: -20px;
        }

        .loi-docs-list li {
            margin-bottom: 10px;
        }

        .loi-signature-section {
            margin-top: 30px;
        }

        .loi-sig-left p {
            margin: 3px 0;
        }

        .loi-acceptance {
            margin-top: 40px;
        }

        .loi-signature-row {
            display: flex;
            align-items: flex-start;
            gap: 40px;
            margin-bottom: 20px;
        }

        .loi-sig-date {
            min-width: 120px;
        }

        .loi-sig-content {
            flex: 1;
        }

        .loi-sig-by {
            margin: 0 0 5px 0;
        }

        .loi-sig-label {
            margin: 0 0 3px 0;
            padding-left: 30px;
        }

        .loi-sig-detail {
            margin: 0 0 3px 0;
            padding-left: 30px;
            color: #333;
        }

        .loi-blank-line {
            display: inline-block;
            min-width: 120px;
        }

        .loi-accept-title {
            margin-top: 40px;
            margin-bottom: 20px;
        }

        .loi-footer-doc {
            margin-top: 40px;
            font-size: 9pt;
            color: #666;
        }

        .steven-signature {
            font-family: 'Brush Script MT', 'Segoe Script', 'Bradley Hand', cursive;
            font-size: 24pt;
            color: #1a1a1a;
            border-bottom: 1px solid #000;
            padding-bottom: 2px;
        }

        @media print {
            #loi-document.printing {
                display: block !important;
                padding: 0.5in 0.6in;
                font-size: 10pt;
                line-height: 1.4;
            }

            .loi-body p {
                margin-bottom: 10px;
            }

            .loi-body h3 {
                margin-top: 15px;
                margin-bottom: 8px;
            }

            .loi-steps-box {
                padding: 15px;
                margin: 15px 0;
            }

            .loi-signature-section {
                page-break-inside: avoid;
            }

            .loi-acceptance {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Real Estate Underwriting Calculator</h1>
            <p class="subtitle">Comprehensive deal analysis with seller financing & equity carry</p>
        </header>

        <!-- Property & Preparer Info -->
        <div class="info-bar">
            <div class="info-row-full">
                <div class="info-section">
                    <div class="info-section-title">üìç Property Address</div>
                    <div class="info-row">
                        <input type="text" id="propertyAddress" placeholder="Enter property address..." class="info-input" style="flex: 2;">
                        <input type="url" id="propertyLink" placeholder="Property listing URL (Zillow, Redfin, etc.)" class="info-input" style="flex: 1;">
                    </div>
                </div>
            </div>
            <div class="info-row-full">
                <div class="info-section">
                    <div class="info-section-title">üë§ Prepared By</div>
                    <div class="info-row">
                        <input type="text" id="preparerName" placeholder="Your name" class="info-input">
                        <input type="email" id="preparerEmail" placeholder="Email address" class="info-input">
                        <input type="tel" id="preparerPhone" placeholder="Phone number" class="info-input">
                    </div>
                </div>
            </div>
            <div class="info-row-full">
                <div class="info-section">
                    <div class="info-section-title">üè† Seller Info</div>
                    <div class="info-row">
                        <input type="text" id="sellerName" placeholder="Seller's name" class="info-input">
                        <input type="email" id="sellerEmail" placeholder="Seller's email" class="info-input">
                        <input type="tel" id="sellerPhone" placeholder="Seller's phone" class="info-input">
                    </div>
                </div>
            </div>
        </div>

        <!-- Sticky Dashboard Bar -->
        <div class="sticky-dashboard">
            <div class="dashboard-metric">
                <span class="dashboard-label">Cap Rate</span>
                <span class="dashboard-value" id="dashCapRate">0%</span>
            </div>
            <div class="dashboard-metric">
                <span class="dashboard-label">Blended Rate</span>
                <span class="dashboard-value" id="dashBlendedRate">0%</span>
            </div>
            <div class="dashboard-metric">
                <span class="dashboard-label">Spread</span>
                <span class="dashboard-value" id="dashSpread">0%</span>
            </div>
            <div class="dashboard-metric">
                <span class="dashboard-label">NOI</span>
                <span class="dashboard-value" id="dashNOI">$0</span>
            </div>
            <div class="dashboard-metric">
                <span class="dashboard-label">Monthly CF</span>
                <span class="dashboard-value" id="dashMonthlyCF">$0</span>
            </div>
            <div class="dashboard-metric">
                <span class="dashboard-label">Cash to Seller</span>
                <span class="dashboard-value" id="dashCashToSeller">$0</span>
            </div>
        </div>

        <div class="main-grid">
            <!-- LOAN CONFIGURATION -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-teal">‚öôÔ∏è</div>
                    <h2 class="card-title">Loan Configuration</h2>
                </div>

                <div class="form-group">
                    <label>Category / Property Type</label>
                    <select id="category" class="input-highlight" onchange="calculate()">
                        <option value="DSCR Residential">DSCR Residential</option>
                        <option value="Mixed Use">Mixed Use</option>
                        <option value="12+Residential">12+ Residential</option>
                        <option value="Commercial">Commercial</option>
                        <option value="RV Park">RV Park</option>
                    </select>
                </div>

                <div class="input-row">
                    <div class="form-group">
                        <label>First Loan % / LTV</label>
                        <input type="number" id="firstLoanLTV" value="26" step="1" min="0" max="100" class="input-highlight" onchange="calculate()">
                        <span class="helper-text">% of purchase price</span>
                    </div>
                    <div class="form-group">
                        <label>Seller Carry %</label>
                        <input type="number" id="sellerCarryPct" value="80" step="1" min="0" max="100" class="input-highlight" onchange="calculate()">
                        <span class="helper-text">% of purchase price</span>
                    </div>
                    <div class="form-group">
                        <label>Target Cash to Seller</label>
                        <input type="number" id="targetCashToSeller" value="" step="1000" min="0" class="input-highlight input-target" placeholder="Optional" onchange="calculateFromTarget()">
                        <span class="helper-text">NET after closing costs</span>
                    </div>
                </div>

                <div class="input-row">
                    <div class="form-group">
                        <label>Interest Only? (First Loan)</label>
                        <select id="interestOnly" class="input-highlight" onchange="calculate()">
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Interest @ Balloon?</label>
                        <select id="interestAtBalloon" class="input-highlight" onchange="calculate()">
                            <option value="No">No</option>
                            <option value="Yes">Yes</option>
                        </select>
                    </div>
                </div>

                <div class="input-row">
                    <div class="form-group">
                        <label>Months to Stabilize</label>
                        <input type="number" id="monthsToStabilize" value="0" step="1" min="0" class="input-highlight" onchange="calculate()">
                    </div>
                    <div class="form-group">
                        <label>% Revenue During Stabilization</label>
                        <input type="number" id="revenueDuringStab" value="100" step="1" min="0" max="100" class="input-highlight" onchange="calculate()">
                    </div>
                </div>

                <div class="form-group">
                    <label>Years to Balloon</label>
                    <input type="number" id="yearsToBalloon" value="8" step="1" min="1" class="input-highlight" onchange="calculate()">
                </div>
            </div>

            <!-- PURCHASE & PRICING -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-amber">üí∞</div>
                    <h2 class="card-title">Purchase & Pricing</h2>
                </div>

                <div class="form-group">
                    <label>Purchase Price ($)</label>
                    <input type="number" id="purchasePrice" value="675000" step="1000" class="input-highlight" onchange="calculate()">
                </div>

                <div class="form-group">
                    <label>Asking Price ($)</label>
                    <input type="number" id="askingPrice" value="675000" step="1000" class="input-highlight" onchange="calculate()">
                </div>

                <div class="result-grid">
                    <div class="result-item full-width">
                        <div class="result-label">Over/Under Asking</div>
                        <div class="result-value" id="overUnderAsking">0.00%</div>
                    </div>
                </div>

                <div class="section-divider"></div>

                <div class="form-group">
                    <label>Annual Rental Revenue ($)</label>
                    <input type="number" id="rentalRevenue" value="48000" step="100" class="input-highlight" onchange="calculate()">
                    <span class="helper-text">Monthly: <span id="monthlyRevenue">$202,993</span></span>
                </div>

                <div class="form-group">
                    <label>Appreciation per Year (%)</label>
                    <input type="number" id="appreciationRate" value="2" step="0.1" min="0" class="input-highlight" onchange="calculate()">
                </div>
            </div>

            <!-- CASH TO BUYER -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-green">üè¶</div>
                    <h2 class="card-title">Cash to Buyer Analysis</h2>
                </div>

                <div class="input-row">
                    <div class="form-group">
                        <label>Agent Fee ($)</label>
                        <input type="number" id="agentFee" value="16500" step="100" class="input-highlight" onchange="calculate()">
                    </div>
                    <div class="form-group">
                        <label>Rehab Cost ($)</label>
                        <input type="number" id="rehabCost" value="0" step="100" class="input-highlight" onchange="calculate()">
                    </div>
                </div>

                <div class="input-row">
                    <div class="form-group">
                        <label>Assignment Fee (%)</label>
                        <input type="number" id="assignmentFeePct" value="5" step="0.5" min="0" class="input-highlight" onchange="calculate()">
                    </div>
                    <div class="form-group">
                        <label>Commercial Appraisal ($)</label>
                        <input type="number" id="appraisalCost" value="0" step="100" class="input-highlight" onchange="calculate()">
                    </div>
                </div>

                <div class="form-group">
                    <label>Closing & Bridge Loan Cost (%)</label>
                    <input type="number" id="closingCostPct" value="5" step="0.5" min="0" class="input-highlight" onchange="calculate()">
                </div>

                <div class="cash-breakdown">
                    <div class="cash-breakdown-title">Cash Breakdown</div>
                    <div class="expense-row">
                        <span class="expense-label">Residual (Equity Gain)</span>
                        <span class="expense-value" id="residualValue">$0</span>
                    </div>
                    <div class="expense-row">
                        <span class="expense-label">Agent Fee</span>
                        <span class="expense-value" id="agentFeeDisplay">$0</span>
                    </div>
                    <div class="expense-row">
                        <span class="expense-label">Rehab</span>
                        <span class="expense-value" id="rehabDisplay">$0</span>
                    </div>
                    <div class="expense-row">
                        <span class="expense-label">Assignment Fee</span>
                        <span class="expense-value" id="assignmentFeeDisplay">$0</span>
                    </div>
                    <div class="expense-row">
                        <span class="expense-label">Reserves for Stabilization</span>
                        <span class="expense-value" id="stabReserves">$0</span>
                    </div>
                    <div class="expense-row">
                        <span class="expense-label">Commercial Appraisal</span>
                        <span class="expense-value" id="appraisalDisplay">$0</span>
                    </div>
                    <div class="expense-row">
                        <span class="expense-label">Closing & Bridge Loan</span>
                        <span class="expense-value" id="closingCostDisplay">$0</span>
                    </div>
                    <div class="expense-row total-row">
                        <span class="expense-label">Cash to Buyer</span>
                        <span class="expense-value" id="cashToBuyer">$0</span>
                    </div>
                </div>
            </div>

            <!-- FINANCING OVERVIEW -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-blue">üìä</div>
                    <h2 class="card-title">Financing Overview</h2>
                </div>

                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">First Position Loan</div>
                        <div class="result-value highlight" id="firstPositionLoan">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Interest Rate</div>
                        <div class="result-value" id="firstPositionRate">0%</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Amortization</div>
                        <div class="result-value" id="firstPositionAmort">0 yrs</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Monthly Payment</div>
                        <div class="result-value" id="firstPositionPayment">$0</div>
                    </div>
                </div>

                <div class="section-divider"></div>

                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">Seller Carry</div>
                        <div class="result-value highlight" id="sellerCarryAmount">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Seller Carry Rate</div>
                        <input type="number" id="sellerCarryRate" value="0" step="0.1" min="0" max="20" style="width:100%;padding:0.5rem;font-size:1rem;" onchange="calculate()">
                    </div>
                    <div class="result-item">
                        <div class="result-label">Amortization</div>
                        <input type="number" id="sellerCarryAmort" value="30" step="1" min="1" max="40" style="width:100%;padding:0.5rem;font-size:1rem;" onchange="calculate()">
                    </div>
                    <div class="result-item">
                        <div class="result-label">Monthly Payment</div>
                        <div class="result-value" id="sellerCarryPayment">$0</div>
                    </div>
                </div>

                <div class="section-divider"></div>

                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">Down Payment</div>
                        <div class="result-value amber" id="downPayment">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Total Financing %</div>
                        <div class="result-value" id="totalFinancingPct">0%</div>
                    </div>
                </div>
            </div>

            <!-- OPERATING EXPENSES -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-red">üìã</div>
                    <h2 class="card-title">Operating Expenses</h2>
                </div>

                <div class="percentage-inputs">
                    <div class="form-group">
                        <label>Property Tax ($/yr)</label>
                        <input type="number" id="propertyTax" value="3000" step="100" onchange="calculate()">
                    </div>
                    <div class="form-group">
                        <label>Insurance ($/yr)</label>
                        <input type="number" id="insurance" value="3000" step="100" onchange="calculate()">
                    </div>
                    <div class="form-group">
                        <label>HOA ($/yr)</label>
                        <input type="number" id="hoa" value="0" step="100" onchange="calculate()">
                    </div>
                    <div class="form-group">
                        <label>Other Expenses ($/yr)</label>
                        <input type="number" id="otherExpenses" value="0" step="100" onchange="calculate()">
                    </div>
                </div>

                <div class="section-divider"></div>

                <div class="percentage-inputs">
                    <div class="form-group">
                        <label>CapEx & Maint (% Revenue)</label>
                        <input type="number" id="capexPct" value="2" step="1" min="0" max="50" onchange="calculate()">
                    </div>
                    <div class="form-group">
                        <label>Management (% Revenue)</label>
                        <input type="number" id="managementPct" value="8" step="1" min="0" max="50" onchange="calculate()">
                    </div>
                    <div class="form-group">
                        <label>Vacancy (% Revenue)</label>
                        <input type="number" id="vacancyPct" value="5" step="1" min="0" max="50" onchange="calculate()">
                    </div>
                </div>

                <div class="result-grid" style="margin-top:1rem;">
                    <div class="result-item full-width">
                        <div class="result-label">Total Operating Expenses (Annual)</div>
                        <div class="result-value negative" id="totalOpExpenses">$0</div>
                    </div>
                </div>
            </div>

            <!-- CASH FLOW ANALYSIS -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-green">üíµ</div>
                    <h2 class="card-title">Cash Flow Analysis</h2>
                </div>

                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">Annual Revenue</div>
                        <div class="result-value" id="annualRevenue">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Operating Expenses</div>
                        <div class="result-value negative" id="opExpensesDisplay">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">First Position P&I</div>
                        <div class="result-value negative" id="firstPIPayout">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Seller Carry Payment</div>
                        <div class="result-value negative" id="sellerCarryPayout">$0</div>
                    </div>
                </div>

                <div class="section-divider"></div>

                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">Annual Cash Flow</div>
                        <div class="result-value positive" id="annualCashFlow">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Monthly Cash Flow</div>
                        <div class="result-value positive" id="monthlyCashFlow">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Cash-on-Cash Return</div>
                        <div class="result-value highlight" id="cocReturn">0%</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">CF to Purchase Price</div>
                        <div class="result-value" id="cfToPurchase">0%</div>
                    </div>
                </div>
            </div>

            <!-- NOI & CAP RATE -->
            <div class="card summary-card">
                <div class="card-header">
                    <div class="card-icon icon-amber">üìà</div>
                    <h2 class="card-title">NOI & Cap Rate</h2>
                </div>

                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">Net Operating Income (NOI)</div>
                        <div class="result-value positive" id="noiValue">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Cap Rate</div>
                        <div class="result-value highlight" id="capRate">0%</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Blended Interest Rate</div>
                        <div class="result-value" id="blendedRate">0%</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Spread (Cap - Blended)</div>
                        <div class="result-value" id="capBlendedSpread">0%</div>
                    </div>
                </div>

                <div class="spread-indicator" id="spreadIndicator">
                    <span class="spread-icon">‚úì</span>
                    <span class="spread-text">Positive spread ‚Äî capital stacking works</span>
                </div>
            </div>

            <!-- BALLOON & EQUITY -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-blue">üéà</div>
                    <h2 class="card-title">Balloon & Equity Analysis</h2>
                </div>

                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">Value @ Balloon</div>
                        <div class="result-value highlight" id="valueAtBalloon">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Total Balance @ Balloon</div>
                        <div class="result-value negative" id="balanceAtBalloon">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Equity @ Balloon</div>
                        <div class="result-value positive" id="equityAtBalloon">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Equity % @ Balloon</div>
                        <div class="result-value" id="equityPctBalloon">0%</div>
                    </div>
                </div>

                <div class="section-divider"></div>

                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">First Position Balance</div>
                        <div class="result-value" id="firstPositionBalance">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Seller Carry Balance</div>
                        <div class="result-value" id="sellerCarryBalance">$0</div>
                    </div>
                </div>
            </div>

            <!-- LOI SUMMARY -->
            <div class="card">
                <div class="card-header">
                    <div class="card-icon icon-teal">üìù</div>
                    <h2 class="card-title">LOI Summary</h2>
                </div>

                <table class="loi-table">
                    <tr>
                        <td>Purchase Price</td>
                        <td id="loiPurchasePrice">$0</td>
                    </tr>
                    <tr>
                        <td>Cash to Seller at Closing</td>
                        <td id="loiCashToSeller">$0</td>
                    </tr>
                    <tr>
                        <td>Seller Equity Agreement</td>
                        <td id="loiSellerEquity">$0</td>
                    </tr>
                    <tr>
                        <td>Amortization (Years)</td>
                        <td id="loiAmortization">0</td>
                    </tr>
                    <tr>
                        <td># Years to Balloon</td>
                        <td id="loiYearsBalloon">0</td>
                    </tr>
                    <tr>
                        <td>Months to Stabilize</td>
                        <td id="loiMonthsStabilize">0</td>
                    </tr>
                    <tr>
                        <td>Monthly Payments to Seller</td>
                        <td id="loiMonthlyPayment">$0</td>
                    </tr>
                    <tr>
                        <td>Interest Rate to Seller</td>
                        <td id="loiInterestRate">0%</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- AI Prompt Generator Section -->
        <div class="market-analysis-section" style="margin-top: 2rem;">
            <div class="market-header">
                <div class="market-header-left">
                    <div class="card-icon icon-blue">ü§ñ</div>
                    <h2 class="card-title">AI Deal Analysis</h2>
                </div>
                <button class="generate-prompt-btn" onclick="generatePrompt()">
                    <span>‚ú® Generate AI Prompt</span>
                </button>
            </div>

            <div class="prompt-section" id="promptSection">
                <p class="prompt-instructions">Click "Generate AI Prompt" to create a prompt with all your deal data that you can paste into ChatGPT, Claude, or any AI assistant for a detailed deal and market analysis.</p>
            </div>
        </div>

        <!-- Export Buttons -->
        <div class="export-buttons">
            <button class="save-btn" onclick="saveToFile()">
                <span>üíæ</span> Save Deal
            </button>
            <button class="load-btn" onclick="document.getElementById('loadFileInput').click()">
                <span>üìÇ</span> Load Deal
            </button>
            <input type="file" id="loadFileInput" accept=".json" style="display: none;" onchange="loadFromFile(event)">
            <button class="print-btn" onclick="generatePDF()">
                <span>üìÑ</span> Export PDF Summary
            </button>
            <button class="loi-btn" onclick="generateLOI()">
                <span>üìù</span> Generate LOI
            </button>
            <a href="https://docs.google.com/spreadsheets/d/YOUR_SPREADSHEET_ID/copy" class="excel-btn" target="_blank">
                <span>üìä</span> Download Excel Template
            </a>
        </div>

        <footer>
            Real Estate Underwriting Calculator ‚Ä¢ All calculations are estimates only
        </footer>
    </div>

    <script>
        // Utility functions
        function formatCurrency(num) {
            if (isNaN(num) || !isFinite(num)) return '$0';
            const absNum = Math.abs(num);
            if (absNum >= 1000000) {
                return (num < 0 ? '-' : '') + '$' + (absNum / 1000000).toFixed(2) + 'M';
            }
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(num);
        }

        function formatPercent(num, decimals = 2) {
            if (isNaN(num) || !isFinite(num)) return '0%';
            return (num * 100).toFixed(decimals) + '%';
        }

        // PMT function (Excel equivalent)
        function PMT(rate, nper, pv, fv = 0, type = 0) {
            if (rate === 0) return -(pv + fv) / nper;
            const pvif = Math.pow(1 + rate, nper);
            let pmt = rate / (pvif - 1) * -(pv * pvif + fv);
            if (type === 1) pmt /= (1 + rate);
            return pmt;
        }

        // Calculate remaining balance after n payments
        function remainingBalance(principal, rate, totalPayments, paymentsMade) {
            if (rate === 0) return principal - (principal / totalPayments) * paymentsMade;
            const monthlyRate = rate / 12;
            const balance = principal * Math.pow(1 + monthlyRate, paymentsMade) - 
                            PMT(monthlyRate, totalPayments, -principal) * 
                            (Math.pow(1 + monthlyRate, paymentsMade) - 1) / monthlyRate;
            return Math.max(0, balance);
        }

        // Get interest rate based on category
        function getInterestRate(category) {
            switch(category) {
                case 'DSCR Residential': return 0.08;
                case '12+Residential': return 0.09;
                case 'Commercial': return 0.10;
                case 'RV Park': return 0.11;
                case 'Mixed Use': return 0.10;
                default: return 0.10;
            }
        }

        // Get amortization based on category
        function getAmortization(category) {
            switch(category) {
                case 'DSCR Residential': return 30;
                case '12+Residential': return 30;
                case 'Commercial': return 25;
                case 'RV Park': return 25;
                case 'Mixed Use': return 25;
                default: return 25;
            }
        }

        // Calculate First Loan % from Target Cash to Seller (NET after closing costs)
        function calculateFromTarget() {
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const targetNetCash = parseFloat(document.getElementById('targetCashToSeller').value) || 0;
            const closingCostPct = parseFloat(document.getElementById('closingCostPct').value) / 100 || 0;
            const agentFee = parseFloat(document.getElementById('agentFee').value) || 0;
            
            if (purchasePrice > 0 && targetNetCash > 0) {
                // Calculate closing costs based on purchase price
                const closingCosts = purchasePrice * closingCostPct;
                
                // First Position Loan needs to cover: target net + closing costs + agent fee
                const requiredFirstLoan = targetNetCash + closingCosts + agentFee;
                
                // Calculate what First Loan % should be
                const firstLoanPct = (requiredFirstLoan / purchasePrice) * 100;
                
                // Update the First Loan % field (round to 1 decimal)
                document.getElementById('firstLoanLTV').value = Math.round(firstLoanPct * 10) / 10;
            }
            
            // Recalculate everything (but don't loop back)
            calculateWithoutTargetAdjust();
        }

        // Main calculation without target adjustment (to prevent loops)
        function calculateWithoutTargetAdjust() {
            runCalculations();
        }

        function calculate() {
            // If target cash is set, recalculate First Loan % first
            const targetNetCash = parseFloat(document.getElementById('targetCashToSeller').value) || 0;
            if (targetNetCash > 0) {
                const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
                const closingCostPct = parseFloat(document.getElementById('closingCostPct').value) / 100 || 0;
                const agentFee = parseFloat(document.getElementById('agentFee').value) || 0;
                
                if (purchasePrice > 0) {
                    const closingCosts = purchasePrice * closingCostPct;
                    const requiredFirstLoan = targetNetCash + closingCosts + agentFee;
                    const firstLoanPct = (requiredFirstLoan / purchasePrice) * 100;
                    document.getElementById('firstLoanLTV').value = Math.round(firstLoanPct * 10) / 10;
                }
            }
            
            runCalculations();
        }

        function runCalculations() {
            // Get all inputs
            const category = document.getElementById('category').value;
            const firstLoanLTV = parseFloat(document.getElementById('firstLoanLTV').value) / 100 || 0;
            const sellerCarryPct = parseFloat(document.getElementById('sellerCarryPct').value) / 100 || 0;
            const interestOnly = document.getElementById('interestOnly').value;
            const interestAtBalloon = document.getElementById('interestAtBalloon').value;
            const monthsToStabilize = parseInt(document.getElementById('monthsToStabilize').value) || 0;
            const revenueDuringStab = parseFloat(document.getElementById('revenueDuringStab').value) / 100 || 1;
            const yearsToBalloon = parseInt(document.getElementById('yearsToBalloon').value) || 8;

            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const askingPrice = parseFloat(document.getElementById('askingPrice').value) || 0;
            const rentalRevenueAnnual = parseFloat(document.getElementById('rentalRevenue').value) || 0;
            const rentalRevenueMonthly = rentalRevenueAnnual / 12;
            const appreciationRate = parseFloat(document.getElementById('appreciationRate').value) / 100 || 0;

            const agentFee = parseFloat(document.getElementById('agentFee').value) || 0;
            const rehabCost = parseFloat(document.getElementById('rehabCost').value) || 0;
            const assignmentFeePct = parseFloat(document.getElementById('assignmentFeePct').value) / 100 || 0;
            const appraisalCost = parseFloat(document.getElementById('appraisalCost').value) || 0;
            const closingCostPct = parseFloat(document.getElementById('closingCostPct').value) / 100 || 0;

            const sellerCarryRate = parseFloat(document.getElementById('sellerCarryRate').value) / 100 || 0;
            const sellerCarryAmort = parseInt(document.getElementById('sellerCarryAmort').value) || 30;

            const propertyTax = parseFloat(document.getElementById('propertyTax').value) || 0;
            const insurance = parseFloat(document.getElementById('insurance').value) || 0;
            const hoa = parseFloat(document.getElementById('hoa').value) || 0;
            const otherExpenses = parseFloat(document.getElementById('otherExpenses').value) || 0;
            const capexPct = parseFloat(document.getElementById('capexPct').value) / 100 || 0;
            const managementPct = parseFloat(document.getElementById('managementPct').value) / 100 || 0;
            const vacancyPct = parseFloat(document.getElementById('vacancyPct').value) / 100 || 0;

            // Get rates from category
            const firstPositionRate = getInterestRate(category);
            const firstPositionAmort = getAmortization(category);

            // Calculate financing
            const firstPositionLoan = purchasePrice * firstLoanLTV;
            const sellerCarryAmount = purchasePrice * sellerCarryPct;
            const totalFinancingPct = firstLoanLTV + sellerCarryPct;
            const downPayment = purchasePrice * (1 - totalFinancingPct);

            // Calculate payments
            let firstPositionPaymentMonthly;
            if (interestOnly === 'Yes') {
                firstPositionPaymentMonthly = (firstPositionLoan * firstPositionRate) / 12;
            } else {
                firstPositionPaymentMonthly = -PMT(firstPositionRate / 12, firstPositionAmort * 12, firstPositionLoan);
            }

            let sellerCarryPaymentMonthly;
            if (interestAtBalloon === 'Yes' || sellerCarryRate === 0) {
                sellerCarryPaymentMonthly = -PMT(0, sellerCarryAmort * 12, sellerCarryAmount);
            } else {
                sellerCarryPaymentMonthly = -PMT(sellerCarryRate / 12, sellerCarryAmort * 12, sellerCarryAmount);
            }

            // Operating expenses
            const percentageExpenses = rentalRevenueAnnual * (capexPct + managementPct + vacancyPct);
            const fixedExpenses = propertyTax + insurance + hoa + otherExpenses;
            const totalOpExpenses = percentageExpenses + fixedExpenses;
            const totalOpExpensesMonthly = totalOpExpenses / 12;

            // Cash flow calculations
            const firstPIAnnual = firstPositionPaymentMonthly * 12;
            const sellerCarryAnnual = sellerCarryPaymentMonthly * 12;
            const annualCashFlow = rentalRevenueAnnual - totalOpExpenses - firstPIAnnual - sellerCarryAnnual;
            const monthlyCashFlow = annualCashFlow / 12;

            // Cash to buyer calculations
            const residual = (purchasePrice * totalFinancingPct) - purchasePrice;
            const assignmentFee = purchasePrice * assignmentFeePct;
            const closingCost = purchasePrice * closingCostPct;
            
            // Reserves for stabilization
            let stabReserves = 0;
            if (monthsToStabilize > 0) {
                stabReserves = -monthsToStabilize * ((rentalRevenueMonthly * revenueDuringStab) - totalOpExpensesMonthly + sellerCarryPaymentMonthly);
            }

            const cashToBuyer = residual - agentFee - rehabCost - assignmentFee - stabReserves - appraisalCost - closingCost;

            // NOI (before debt service, but after operating expenses)
            const noi = rentalRevenueAnnual - totalOpExpenses;
            const capRate = purchasePrice > 0 ? noi / purchasePrice : 0;

            // Blended interest rate calculation
            const totalFinancingAmount = firstPositionLoan + sellerCarryAmount;
            let blendedRate = 0;
            if (totalFinancingAmount > 0) {
                blendedRate = ((firstPositionLoan * firstPositionRate) + (sellerCarryAmount * sellerCarryRate)) / totalFinancingAmount;
            }
            const capBlendedSpread = capRate - blendedRate;

            // Cash on Cash return
            const cashInvested = Math.abs(cashToBuyer) > 0 ? Math.abs(cashToBuyer) : downPayment;
            const cocReturn = cashInvested > 0 ? annualCashFlow / cashInvested : 0;
            const cfToPurchase = purchasePrice > 0 ? annualCashFlow / purchasePrice : 0;

            // Balloon calculations
            const valueAtBalloon = (askingPrice + rehabCost) * Math.pow(1 + appreciationRate, yearsToBalloon);
            
            // Calculate remaining balances
            const monthsToBalloon = yearsToBalloon * 12;
            let firstPositionBalance;
            if (interestOnly === 'Yes') {
                firstPositionBalance = firstPositionLoan;
            } else {
                firstPositionBalance = remainingBalance(firstPositionLoan, firstPositionRate, firstPositionAmort * 12, monthsToBalloon);
            }

            const sellerPaymentMonths = monthsToBalloon - monthsToStabilize;
            let sellerCarryBalance;
            if (interestAtBalloon === 'Yes') {
                // Principal only payments, so calculate remaining
                const principalPayment = sellerCarryAmount / (sellerCarryAmort * 12);
                sellerCarryBalance = sellerCarryAmount - (principalPayment * sellerPaymentMonths);
                // Add accumulated interest if interest at balloon
                if (sellerCarryRate > 0) {
                    // This is a simplification - actual would compound
                    sellerCarryBalance += sellerCarryAmount * sellerCarryRate * (sellerPaymentMonths / 12);
                }
            } else {
                sellerCarryBalance = remainingBalance(sellerCarryAmount, sellerCarryRate, sellerCarryAmort * 12, sellerPaymentMonths);
            }

            const totalBalance = firstPositionBalance + sellerCarryBalance;
            const equityAtBalloon = valueAtBalloon - totalBalance;
            const equityPctBalloon = valueAtBalloon > 0 ? equityAtBalloon / valueAtBalloon : 0;

            // Over/Under asking
            const overUnderAsking = askingPrice > 0 ? (purchasePrice - askingPrice) / askingPrice : 0;

            // Update UI
            document.getElementById('monthlyRevenue').textContent = formatCurrency(rentalRevenueMonthly);
            document.getElementById('overUnderAsking').textContent = formatPercent(overUnderAsking);
            document.getElementById('overUnderAsking').className = 'result-value ' + (overUnderAsking < 0 ? 'positive' : overUnderAsking > 0 ? 'negative' : '');

            // Financing
            document.getElementById('firstPositionLoan').textContent = formatCurrency(firstPositionLoan);
            document.getElementById('firstPositionRate').textContent = formatPercent(firstPositionRate, 1);
            document.getElementById('firstPositionAmort').textContent = firstPositionAmort + ' yrs';
            document.getElementById('firstPositionPayment').textContent = formatCurrency(firstPositionPaymentMonthly);
            document.getElementById('sellerCarryAmount').textContent = formatCurrency(sellerCarryAmount);
            document.getElementById('sellerCarryPayment').textContent = formatCurrency(sellerCarryPaymentMonthly);
            document.getElementById('downPayment').textContent = formatCurrency(downPayment);
            document.getElementById('totalFinancingPct').textContent = formatPercent(totalFinancingPct, 0);

            // Cash to buyer breakdown
            document.getElementById('residualValue').textContent = formatCurrency(residual);
            document.getElementById('agentFeeDisplay').textContent = formatCurrency(agentFee);
            document.getElementById('rehabDisplay').textContent = formatCurrency(rehabCost);
            document.getElementById('assignmentFeeDisplay').textContent = formatCurrency(assignmentFee);
            document.getElementById('stabReserves').textContent = formatCurrency(stabReserves);
            document.getElementById('appraisalDisplay').textContent = formatCurrency(appraisalCost);
            document.getElementById('closingCostDisplay').textContent = formatCurrency(closingCost);
            document.getElementById('cashToBuyer').textContent = formatCurrency(cashToBuyer);

            // Operating expenses
            document.getElementById('totalOpExpenses').textContent = formatCurrency(totalOpExpenses);

            // Cash flow
            document.getElementById('annualRevenue').textContent = formatCurrency(rentalRevenueAnnual);
            document.getElementById('opExpensesDisplay').textContent = formatCurrency(totalOpExpenses);
            document.getElementById('firstPIPayout').textContent = formatCurrency(firstPIAnnual);
            document.getElementById('sellerCarryPayout').textContent = formatCurrency(sellerCarryAnnual);
            document.getElementById('annualCashFlow').textContent = formatCurrency(annualCashFlow);
            document.getElementById('annualCashFlow').className = 'result-value ' + (annualCashFlow >= 0 ? 'positive' : 'negative');
            document.getElementById('monthlyCashFlow').textContent = formatCurrency(monthlyCashFlow);
            document.getElementById('monthlyCashFlow').className = 'result-value ' + (monthlyCashFlow >= 0 ? 'positive' : 'negative');
            document.getElementById('cocReturn').textContent = formatPercent(cocReturn);
            document.getElementById('cfToPurchase').textContent = formatPercent(cfToPurchase);

            // NOI
            document.getElementById('noiValue').textContent = formatCurrency(noi);
            document.getElementById('capRate').textContent = formatPercent(capRate);
            document.getElementById('blendedRate').textContent = formatPercent(blendedRate);
            document.getElementById('capBlendedSpread').textContent = formatPercent(capBlendedSpread);
            
            // Update spread indicator
            const spreadIndicator = document.getElementById('spreadIndicator');
            if (capBlendedSpread > 0.001) {
                spreadIndicator.className = 'spread-indicator positive';
                spreadIndicator.innerHTML = '<span class="spread-icon">‚úì</span><span class="spread-text">Positive spread ‚Äî capital stacking works</span>';
            } else if (capBlendedSpread < -0.001) {
                spreadIndicator.className = 'spread-indicator negative';
                spreadIndicator.innerHTML = '<span class="spread-icon">‚úó</span><span class="spread-text">Negative spread ‚Äî cap rate below blended rate</span>';
            } else {
                spreadIndicator.className = 'spread-indicator neutral';
                spreadIndicator.innerHTML = '<span class="spread-icon">‚àí</span><span class="spread-text">Break-even ‚Äî cap rate equals blended rate</span>';
            }

            // Balloon
            document.getElementById('valueAtBalloon').textContent = formatCurrency(valueAtBalloon);
            document.getElementById('balanceAtBalloon').textContent = formatCurrency(totalBalance);
            document.getElementById('equityAtBalloon').textContent = formatCurrency(equityAtBalloon);
            document.getElementById('equityPctBalloon').textContent = formatPercent(equityPctBalloon);
            document.getElementById('firstPositionBalance').textContent = formatCurrency(firstPositionBalance);
            document.getElementById('sellerCarryBalance').textContent = formatCurrency(sellerCarryBalance);

            // LOI Summary
            const cashToSellerAtClosing = firstPositionLoan - closingCost - agentFee;
            document.getElementById('loiPurchasePrice').textContent = formatCurrency(purchasePrice);
            document.getElementById('loiCashToSeller').textContent = formatCurrency(cashToSellerAtClosing);
            document.getElementById('loiSellerEquity').textContent = formatCurrency(sellerCarryAmount);
            document.getElementById('loiAmortization').textContent = sellerCarryAmort;
            document.getElementById('loiYearsBalloon').textContent = yearsToBalloon;
            document.getElementById('loiMonthsStabilize').textContent = monthsToStabilize;
            document.getElementById('loiMonthlyPayment').textContent = formatCurrency(sellerCarryPaymentMonthly);
            document.getElementById('loiInterestRate').textContent = formatPercent(sellerCarryRate, 1);

            // Sticky Dashboard
            document.getElementById('dashCapRate').textContent = formatPercent(capRate);
            document.getElementById('dashBlendedRate').textContent = formatPercent(blendedRate);
            document.getElementById('dashSpread').textContent = formatPercent(capBlendedSpread);
            document.getElementById('dashSpread').className = 'dashboard-value ' + (capBlendedSpread >= 0 ? 'positive' : 'negative');
            document.getElementById('dashNOI').textContent = formatCurrency(noi);
            document.getElementById('dashMonthlyCF').textContent = formatCurrency(monthlyCashFlow);
            document.getElementById('dashMonthlyCF').className = 'dashboard-value ' + (monthlyCashFlow >= 0 ? 'positive' : 'negative');
            document.getElementById('dashCashToSeller').textContent = formatCurrency(cashToSellerAtClosing);
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            calculate();
        });

        // Generate AI Prompt
        function generatePrompt() {
            const address = document.getElementById('propertyAddress').value.trim() || '[ADDRESS NOT ENTERED]';
            const category = document.getElementById('category').value;
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const askingPrice = parseFloat(document.getElementById('askingPrice').value) || 0;
            const rentalRevenue = parseFloat(document.getElementById('rentalRevenue').value) || 0;
            const firstLoanLTV = parseFloat(document.getElementById('firstLoanLTV').value) || 0;
            const sellerCarryPct = parseFloat(document.getElementById('sellerCarryPct').value) || 0;
            const sellerCarryRate = parseFloat(document.getElementById('sellerCarryRate').value) || 0;
            const yearsToBalloon = parseInt(document.getElementById('yearsToBalloon').value) || 0;
            
            // Get calculated values
            const capRate = document.getElementById('capRate').textContent;
            const blendedRate = document.getElementById('blendedRate').textContent;
            const spread = document.getElementById('capBlendedSpread').textContent;
            const cashFlow = document.getElementById('annualCashFlow').textContent;
            const cocReturn = document.getElementById('cocReturn').textContent;
            const cashToBuyer = document.getElementById('cashToBuyer').textContent;

            const prompt = `I'm analyzing a real estate deal using an equity carry / capital stacking strategy. Please help me evaluate this deal and research the local market.

PROPERTY & DEAL DETAILS:
- Address: ${address}
- Property Type: ${category}
- Purchase Price: $${purchasePrice.toLocaleString()}
- Asking Price: $${askingPrice.toLocaleString()}
- Expected Annual Rent: $${rentalRevenue.toLocaleString()} ($${Math.round(rentalRevenue/12).toLocaleString()}/month)

FINANCING STRUCTURE:
- First Position Loan: ${firstLoanLTV}% LTV (from traditional lender)
- Seller Carry: ${sellerCarryPct}% of purchase price at ${sellerCarryRate}% interest
- Years to Balloon: ${yearsToBalloon}

CALCULATED METRICS:
- Cap Rate: ${capRate}
- Blended Interest Rate: ${blendedRate}
- Spread (Cap Rate - Blended Rate): ${spread}
- Annual Cash Flow: ${cashFlow}
- Cash-on-Cash Return: ${cocReturn}
- Cash to Buyer at Close: ${cashToBuyer}

PLEASE ANALYZE:

1. DEAL VIABILITY
- Does this deal make sense from a capital stacking perspective?
- Is the spread between cap rate and blended rate healthy?
- Are the returns acceptable for this strategy?
- What are the risks?

2. MARKET RESEARCH (please search for current data)
- What are typical rents for similar properties in this area?
- Is my expected rent realistic, too high, or too low?
- What's the rental vacancy rate in this market?
- Is this area appreciating, stable, or declining?
- Is it currently a buyer's or seller's market?

3. RECOMMENDATION
- Would you proceed with this deal? Why or why not?
- What terms would you try to negotiate differently?
- Any red flags I should investigate further?

Please be direct and specific with your analysis.`;

            const promptSection = document.getElementById('promptSection');
            promptSection.innerHTML = `
                <div class="prompt-output-container">
                    <div class="prompt-output">${prompt}</div>
                    <div class="prompt-actions">
                        <button class="copy-btn" onclick="copyPrompt()">
                            <span>üìã</span> Copy to Clipboard
                        </button>
                    </div>
                    <div class="prompt-tip">
                        üí° Paste this into ChatGPT, Claude, or any AI assistant with web search for the best results.
                    </div>
                </div>
            `;
        }

        function copyPrompt() {
            const promptText = document.querySelector('.prompt-output').textContent;
            navigator.clipboard.writeText(promptText).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.innerHTML = '<span>‚úì</span> Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.innerHTML = '<span>üìã</span> Copy to Clipboard';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        // Save deal to JSON file
        function saveToFile() {
            const data = {
                version: '1.0',
                savedAt: new Date().toISOString(),
                propertyInfo: {
                    address: document.getElementById('propertyAddress').value,
                    link: document.getElementById('propertyLink').value,
                },
                preparer: {
                    name: document.getElementById('preparerName').value,
                    email: document.getElementById('preparerEmail').value,
                    phone: document.getElementById('preparerPhone').value,
                },
                seller: {
                    name: document.getElementById('sellerName').value,
                    email: document.getElementById('sellerEmail').value,
                    phone: document.getElementById('sellerPhone').value,
                },
                dealTerms: {
                    category: document.getElementById('category').value,
                    purchasePrice: document.getElementById('purchasePrice').value,
                    askingPrice: document.getElementById('askingPrice').value,
                    rentalRevenue: document.getElementById('rentalRevenue').value,
                    appreciationRate: document.getElementById('appreciationRate').value,
                },
                financing: {
                    firstLoanLTV: document.getElementById('firstLoanLTV').value,
                    interestOnly: document.getElementById('interestOnly').value,
                    sellerCarryPct: document.getElementById('sellerCarryPct').value,
                    sellerCarryRate: document.getElementById('sellerCarryRate').value,
                    sellerCarryAmort: document.getElementById('sellerCarryAmort').value,
                    interestAtBalloon: document.getElementById('interestAtBalloon').value,
                    yearsToBalloon: document.getElementById('yearsToBalloon').value,
                    targetCashToSeller: document.getElementById('targetCashToSeller').value,
                },
                stabilization: {
                    monthsToStabilize: document.getElementById('monthsToStabilize').value,
                    revenueDuringStab: document.getElementById('revenueDuringStab').value,
                },
                expenses: {
                    propertyTax: document.getElementById('propertyTax').value,
                    insurance: document.getElementById('insurance').value,
                    hoa: document.getElementById('hoa').value,
                    otherExpenses: document.getElementById('otherExpenses').value,
                    capexPct: document.getElementById('capexPct').value,
                    managementPct: document.getElementById('managementPct').value,
                    vacancyPct: document.getElementById('vacancyPct').value,
                },
                cashToBuyer: {
                    agentFee: document.getElementById('agentFee').value,
                    rehabCost: document.getElementById('rehabCost').value,
                    assignmentFeePct: document.getElementById('assignmentFeePct').value,
                    appraisalCost: document.getElementById('appraisalCost').value,
                    closingCostPct: document.getElementById('closingCostPct').value,
                },
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            // Create filename from address
            const address = document.getElementById('propertyAddress').value || 'Untitled_Deal';
            const safeAddress = address.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 40);
            const date = new Date().toISOString().split('T')[0];
            
            a.href = url;
            a.download = `${safeAddress}_${date}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Load deal from JSON file
        function loadFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Property info
                    if (data.propertyInfo) {
                        document.getElementById('propertyAddress').value = data.propertyInfo.address || '';
                        document.getElementById('propertyLink').value = data.propertyInfo.link || '';
                    }
                    
                    // Preparer
                    if (data.preparer) {
                        document.getElementById('preparerName').value = data.preparer.name || '';
                        document.getElementById('preparerEmail').value = data.preparer.email || '';
                        document.getElementById('preparerPhone').value = data.preparer.phone || '';
                    }
                    
                    // Seller
                    if (data.seller) {
                        document.getElementById('sellerName').value = data.seller.name || '';
                        document.getElementById('sellerEmail').value = data.seller.email || '';
                        document.getElementById('sellerPhone').value = data.seller.phone || '';
                    }
                    
                    // Deal terms
                    if (data.dealTerms) {
                        document.getElementById('category').value = data.dealTerms.category || 'DSCR Residential (1-4)';
                        document.getElementById('purchasePrice').value = data.dealTerms.purchasePrice || '';
                        document.getElementById('askingPrice').value = data.dealTerms.askingPrice || '';
                        document.getElementById('rentalRevenue').value = data.dealTerms.rentalRevenue || '';
                        document.getElementById('appreciationRate').value = data.dealTerms.appreciationRate || '';
                    }
                    
                    // Financing
                    if (data.financing) {
                        document.getElementById('firstLoanLTV').value = data.financing.firstLoanLTV || '';
                        document.getElementById('interestOnly').value = data.financing.interestOnly || 'No';
                        document.getElementById('sellerCarryPct').value = data.financing.sellerCarryPct || '';
                        document.getElementById('sellerCarryRate').value = data.financing.sellerCarryRate || '';
                        document.getElementById('sellerCarryAmort').value = data.financing.sellerCarryAmort || '';
                        document.getElementById('interestAtBalloon').value = data.financing.interestAtBalloon || 'No';
                        document.getElementById('yearsToBalloon').value = data.financing.yearsToBalloon || '';
                        document.getElementById('targetCashToSeller').value = data.financing.targetCashToSeller || '';
                    }
                    
                    // Stabilization
                    if (data.stabilization) {
                        document.getElementById('monthsToStabilize').value = data.stabilization.monthsToStabilize || '';
                        document.getElementById('revenueDuringStab').value = data.stabilization.revenueDuringStab || '';
                    }
                    
                    // Expenses
                    if (data.expenses) {
                        document.getElementById('propertyTax').value = data.expenses.propertyTax || '';
                        document.getElementById('insurance').value = data.expenses.insurance || '';
                        document.getElementById('hoa').value = data.expenses.hoa || '';
                        document.getElementById('otherExpenses').value = data.expenses.otherExpenses || '';
                        document.getElementById('capexPct').value = data.expenses.capexPct || '';
                        document.getElementById('managementPct').value = data.expenses.managementPct || '';
                        document.getElementById('vacancyPct').value = data.expenses.vacancyPct || '';
                    }
                    
                    // Cash to buyer
                    if (data.cashToBuyer) {
                        document.getElementById('agentFee').value = data.cashToBuyer.agentFee || '';
                        document.getElementById('rehabCost').value = data.cashToBuyer.rehabCost || '';
                        document.getElementById('assignmentFeePct').value = data.cashToBuyer.assignmentFeePct || '';
                        document.getElementById('appraisalCost').value = data.cashToBuyer.appraisalCost || '';
                        document.getElementById('closingCostPct').value = data.cashToBuyer.closingCostPct || '';
                    }
                    
                    // Recalculate
                    calculate();
                    
                    alert('Deal loaded successfully!');
                } catch (err) {
                    alert('Error loading file: ' + err.message);
                }
            };
            reader.readAsText(file);
            
            // Reset file input so same file can be loaded again
            event.target.value = '';
        }

        // PDF Print functionality
        function generatePDF() {
            // Get property address and preparer info
            const propertyAddress = document.getElementById('propertyAddress').value || 'Address not specified';
            const propertyLink = document.getElementById('propertyLink').value || '';
            const preparerName = document.getElementById('preparerName').value || '';
            const preparerEmail = document.getElementById('preparerEmail').value || '';
            const preparerPhone = document.getElementById('preparerPhone').value || '';
            
            // Update PDF header with address
            document.getElementById('pdf-address').textContent = propertyAddress;
            
            // Update property link
            const pdfPropertyLink = document.getElementById('pdf-property-link');
            if (propertyLink) {
                pdfPropertyLink.innerHTML = `<a href="${propertyLink}" target="_blank">üîó ${propertyLink}</a>`;
                pdfPropertyLink.style.display = 'block';
            } else {
                pdfPropertyLink.style.display = 'none';
            }
            
            // Update preparer info
            document.getElementById('pdf-preparer-name').textContent = preparerName || 'Not specified';
            
            // Build contact string
            let contactParts = [];
            if (preparerEmail) contactParts.push(preparerEmail);
            if (preparerPhone) contactParts.push(preparerPhone);
            document.getElementById('pdf-preparer-contact').textContent = contactParts.join(' ‚Ä¢ ') || '';
            
            // Show/hide preparer box based on whether any info was provided
            const preparerBox = document.getElementById('pdf-preparer-box');
            if (preparerName || preparerEmail || preparerPhone) {
                preparerBox.style.display = 'flex';
            } else {
                preparerBox.style.display = 'none';
            }
            
            // Update PDF summary content
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const category = document.getElementById('category').value;
            
            document.getElementById('pdf-purchase-price').textContent = document.getElementById('loiPurchasePrice').textContent;
            document.getElementById('pdf-property-type').textContent = category;
            document.getElementById('pdf-asking-price').textContent = formatCurrency(parseFloat(document.getElementById('askingPrice').value) || 0);
            document.getElementById('pdf-over-under').textContent = document.getElementById('overUnderAsking').textContent;
            
            // Key metrics
            document.getElementById('pdf-coc').textContent = document.getElementById('cocReturn').textContent;
            document.getElementById('pdf-cap-rate').textContent = document.getElementById('capRate').textContent;
            document.getElementById('pdf-blended-rate').textContent = document.getElementById('blendedRate').textContent;
            document.getElementById('pdf-spread').textContent = document.getElementById('capBlendedSpread').textContent;
            document.getElementById('pdf-annual-cf').textContent = document.getElementById('annualCashFlow').textContent;
            document.getElementById('pdf-noi').textContent = document.getElementById('noiValue').textContent;
            
            // Financing
            document.getElementById('pdf-first-position').textContent = document.getElementById('firstPositionLoan').textContent;
            document.getElementById('pdf-first-rate').textContent = document.getElementById('firstPositionRate').textContent;
            document.getElementById('pdf-first-amort').textContent = document.getElementById('firstPositionAmort').textContent;
            document.getElementById('pdf-first-payment').textContent = document.getElementById('firstPositionPayment').textContent;
            document.getElementById('pdf-seller-carry').textContent = document.getElementById('sellerCarryAmount').textContent;
            document.getElementById('pdf-seller-rate').textContent = document.getElementById('loiInterestRate').textContent;
            document.getElementById('pdf-seller-amort').textContent = document.getElementById('loiAmortization').textContent + ' yrs';
            document.getElementById('pdf-seller-payment').textContent = document.getElementById('sellerCarryPayment').textContent;
            document.getElementById('pdf-down-payment').textContent = document.getElementById('downPayment').textContent;
            document.getElementById('pdf-total-financing').textContent = document.getElementById('totalFinancingPct').textContent;
            
            // Cash to Buyer
            document.getElementById('pdf-residual').textContent = document.getElementById('residualValue').textContent;
            document.getElementById('pdf-assignment').textContent = document.getElementById('assignmentFeeDisplay').textContent;
            document.getElementById('pdf-closing').textContent = document.getElementById('closingCostDisplay').textContent;
            document.getElementById('pdf-cash-to-buyer').textContent = document.getElementById('cashToBuyer').textContent;
            
            // Cash Flow
            document.getElementById('pdf-revenue').textContent = document.getElementById('annualRevenue').textContent;
            document.getElementById('pdf-expenses').textContent = document.getElementById('totalOpExpenses').textContent;
            document.getElementById('pdf-first-pi').textContent = document.getElementById('firstPIPayout').textContent;
            document.getElementById('pdf-seller-pi').textContent = document.getElementById('sellerCarryPayout').textContent;
            document.getElementById('pdf-monthly-cf').textContent = document.getElementById('monthlyCashFlow').textContent;
            document.getElementById('pdf-cf-purchase').textContent = document.getElementById('cfToPurchase').textContent;
            
            // Balloon
            document.getElementById('pdf-years-balloon').textContent = document.getElementById('yearsToBalloon').value + ' years';
            document.getElementById('pdf-value-balloon').textContent = document.getElementById('valueAtBalloon').textContent;
            document.getElementById('pdf-balance-balloon').textContent = document.getElementById('balanceAtBalloon').textContent;
            document.getElementById('pdf-equity-balloon').textContent = document.getElementById('equityAtBalloon').textContent;
            document.getElementById('pdf-equity-pct').textContent = document.getElementById('equityPctBalloon').textContent;
            
            // Date
            document.getElementById('pdf-date').textContent = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Show PDF summary and print
            const pdfSummary = document.getElementById('pdf-summary');
            pdfSummary.style.display = 'block';
            pdfSummary.classList.add('printing');
            
            window.print();
            
            // Hide after print dialog closes
            setTimeout(() => {
                pdfSummary.style.display = 'none';
                pdfSummary.classList.remove('printing');
            }, 1000);
        }

        // LOI Generation
        function generateLOI() {
            // Get values
            const propertyAddress = document.getElementById('propertyAddress').value || '[PROPERTY ADDRESS]';
            const propertyLink = document.getElementById('propertyLink').value || '';
            const preparerName = document.getElementById('preparerName').value || '[Name]';
            const preparerEmail = document.getElementById('preparerEmail').value || '';
            const preparerPhone = document.getElementById('preparerPhone').value || '';
            
            // Seller info
            const sellerName = document.getElementById('sellerName').value || '[Seller Name]';
            const sellerEmail = document.getElementById('sellerEmail').value || '';
            const sellerPhone = document.getElementById('sellerPhone').value || '';
            
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value) || 0;
            const sellerCarryAmort = parseInt(document.getElementById('sellerCarryAmort').value) || 30;
            const yearsToBalloon = parseInt(document.getElementById('yearsToBalloon').value) || 8;

            // Get calculated values
            const cashAtClosing = document.getElementById('firstPositionLoan').textContent;
            const sellerEquity = document.getElementById('sellerCarryAmount').textContent;
            const monthlyPayment = document.getElementById('sellerCarryPayment').textContent;

            // Format dates
            const today = new Date();
            const dateStr = today.toLocaleDateString('en-US', { year: 'numeric', month: 'numeric', day: 'numeric' });
            
            // Expiry date (30 days from now)
            const expiryDate = new Date(today);
            expiryDate.setDate(expiryDate.getDate() + 30);
            const expiryStr = expiryDate.toISOString().split('T')[0];

            // Generate tracking number (format: StreetNum-AllWordsBeforeStreetType-YYYYMMDDSEQ)
            // Example: 3053 S Edgewater Lane ‚Üí 3053-S-EDGEWATER-2026010701
            
            // Street type words to stop at
            const streetTypes = ['STREET', 'ST', 'AVENUE', 'AVE', 'LANE', 'LN', 'DRIVE', 'DR', 'ROAD', 'RD', 
                                'BOULEVARD', 'BLVD', 'COURT', 'CT', 'CIRCLE', 'CIR', 'WAY', 'PLACE', 'PL', 
                                'TERRACE', 'TER', 'TRAIL', 'TRL', 'PARKWAY', 'PKWY', 'HIGHWAY', 'HWY'];
            
            // Extract street number
            const streetNumMatch = propertyAddress.match(/^(\d+)/);
            let streetNum = streetNumMatch ? streetNumMatch[1] : 'XXXXX';
            
            // Get words after street number, before street type
            const addressWithoutNum = propertyAddress.replace(/^\d+\s*/, '');
            const words = addressWithoutNum.split(/[\s,]+/);
            let streetParts = [];
            
            for (let word of words) {
                const cleanWord = word.toUpperCase().replace(/[^A-Z]/g, '');
                if (!cleanWord) continue;
                if (streetTypes.includes(cleanWord)) break;
                streetParts.push(cleanWord);
            }
            
            const streetPortion = streetParts.length > 0 ? streetParts.join('-') : 'UNKNOWN';
            
            // Date portion YYYYMMDD
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const datePart = `${year}${month}${day}`;
            
            // Sequence number (default 01)
            const seq = '01';
            
            const trackingNum = `${streetNum}-${streetPortion}-${datePart}${seq}`;

            // Format currency for display
            const priceFormatted = formatCurrency(purchasePrice);

            // Populate all LOI fields
            document.getElementById('loi-date').textContent = dateStr;
            document.getElementById('loi-property-address').textContent = propertyAddress;
            document.getElementById('loi-tracking').textContent = trackingNum;
            
            // Property link
            const loiPropertyLink = document.getElementById('loi-property-link-container');
            if (propertyLink) {
                loiPropertyLink.innerHTML = `üîó <a href="${propertyLink}" target="_blank">${propertyLink}</a>`;
                loiPropertyLink.style.display = 'block';
            } else {
                loiPropertyLink.style.display = 'none';
            }
            
            document.getElementById('loi-seller-name').textContent = sellerName;
            document.getElementById('loi-address-inline').textContent = propertyAddress;
            document.getElementById('loi-price-inline').textContent = priceFormatted;
            document.getElementById('loi-property-full').textContent = propertyAddress;
            document.getElementById('loi-purchase-price').textContent = priceFormatted;
            document.getElementById('loi-cash-at-closing').textContent = cashAtClosing;
            document.getElementById('loi-seller-equity').textContent = sellerEquity;
            document.getElementById('loi-amort-years').textContent = sellerCarryAmort;
            document.getElementById('loi-monthly-payment').textContent = monthlyPayment;
            document.getElementById('loi-balloon-years').textContent = yearsToBalloon;

            // Steps section
            document.getElementById('loi-step1-price').textContent = priceFormatted;
            document.getElementById('loi-step2-cash').textContent = priceFormatted;
            document.getElementById('loi-step2-payout').textContent = cashAtClosing;
            document.getElementById('loi-step3-remaining').textContent = sellerEquity;
            document.getElementById('loi-step4-payment').textContent = monthlyPayment;
            document.getElementById('loi-step4-balloon').textContent = yearsToBalloon;
            document.getElementById('loi-step5-cash').textContent = cashAtClosing;
            document.getElementById('loi-step5-payment').textContent = monthlyPayment;

            // Expiry and signature
            document.getElementById('loi-expiry-date').textContent = expiryStr;
            document.getElementById('loi-sig-name').textContent = preparerName;
            document.getElementById('loi-sig-email').textContent = preparerEmail;
            document.getElementById('loi-sig-phone').textContent = preparerPhone;
            document.getElementById('loi-accept-date').textContent = dateStr;
            
            // Seller signature section
            document.getElementById('loi-seller-sig-name').textContent = sellerName;
            document.getElementById('loi-seller-sig-email').textContent = sellerEmail;
            document.getElementById('loi-seller-sig-phone').textContent = sellerPhone;

            // Hide other elements and show LOI
            const loiDoc = document.getElementById('loi-document');
            loiDoc.style.display = 'block';
            loiDoc.classList.add('printing');
            
            window.print();

            // Hide after print
            setTimeout(() => {
                loiDoc.style.display = 'none';
                loiDoc.classList.remove('printing');
            }, 1000);
        }
    </script>

    <!-- PDF Summary Template -->
    <div id="pdf-summary">
        <div class="pdf-header">
            <h1>Real Estate Underwriting Summary</h1>
            <div class="pdf-address" id="pdf-address"></div>
            <div class="pdf-property-link" id="pdf-property-link"></div>
            <div class="pdf-date" id="pdf-date"></div>
        </div>

        <div class="pdf-preparer-box" id="pdf-preparer-box">
            <div class="pdf-preparer-title">Prepared By</div>
            <div class="pdf-preparer-info">
                <span id="pdf-preparer-name"></span>
                <span id="pdf-preparer-contact"></span>
            </div>
        </div>

        <div class="pdf-highlight-box">
            <div class="pdf-highlight-item">
                <h3>Cash-on-Cash Return</h3>
                <div class="value" id="pdf-coc">0%</div>
            </div>
            <div class="pdf-highlight-item">
                <h3>Cap Rate</h3>
                <div class="value" id="pdf-cap-rate">0%</div>
            </div>
            <div class="pdf-highlight-item">
                <h3>Blended Rate</h3>
                <div class="value" id="pdf-blended-rate">0%</div>
            </div>
            <div class="pdf-highlight-item">
                <h3>Spread</h3>
                <div class="value" id="pdf-spread">0%</div>
            </div>
            <div class="pdf-highlight-item">
                <h3>Annual Cash Flow</h3>
                <div class="value" id="pdf-annual-cf">$0</div>
            </div>
            <div class="pdf-highlight-item">
                <h3>NOI</h3>
                <div class="value" id="pdf-noi">$0</div>
            </div>
        </div>

        <div class="pdf-two-col">
            <div>
                <div class="pdf-section">
                    <div class="pdf-section-title">Deal Overview</div>
                    <div class="pdf-row">
                        <span class="pdf-label">Purchase Price</span>
                        <span class="pdf-value highlight" id="pdf-purchase-price">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Asking Price</span>
                        <span class="pdf-value" id="pdf-asking-price">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Over/Under Asking</span>
                        <span class="pdf-value" id="pdf-over-under">0%</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Property Type</span>
                        <span class="pdf-value" id="pdf-property-type">Mixed Use</span>
                    </div>
                </div>

                <div class="pdf-section">
                    <div class="pdf-section-title">First Position Loan</div>
                    <div class="pdf-row">
                        <span class="pdf-label">Loan Amount</span>
                        <span class="pdf-value" id="pdf-first-position">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Interest Rate</span>
                        <span class="pdf-value" id="pdf-first-rate">0%</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Amortization</span>
                        <span class="pdf-value" id="pdf-first-amort">0 yrs</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Monthly Payment</span>
                        <span class="pdf-value" id="pdf-first-payment">$0</span>
                    </div>
                </div>

                <div class="pdf-section">
                    <div class="pdf-section-title">Seller Financing</div>
                    <div class="pdf-row">
                        <span class="pdf-label">Seller Carry Amount</span>
                        <span class="pdf-value" id="pdf-seller-carry">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Interest Rate</span>
                        <span class="pdf-value" id="pdf-seller-rate">0%</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Amortization</span>
                        <span class="pdf-value" id="pdf-seller-amort">0 yrs</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Monthly Payment</span>
                        <span class="pdf-value" id="pdf-seller-payment">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Down Payment</span>
                        <span class="pdf-value" id="pdf-down-payment">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Total Financing</span>
                        <span class="pdf-value" id="pdf-total-financing">0%</span>
                    </div>
                </div>
            </div>

            <div>
                <div class="pdf-section">
                    <div class="pdf-section-title">Cash to Buyer</div>
                    <div class="pdf-row">
                        <span class="pdf-label">Residual (Equity Gain)</span>
                        <span class="pdf-value" id="pdf-residual">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Assignment Fee</span>
                        <span class="pdf-value" id="pdf-assignment">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Closing & Bridge Costs</span>
                        <span class="pdf-value" id="pdf-closing">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label"><strong>Net Cash to Buyer</strong></span>
                        <span class="pdf-value highlight" id="pdf-cash-to-buyer">$0</span>
                    </div>
                </div>

                <div class="pdf-section">
                    <div class="pdf-section-title">Cash Flow Analysis</div>
                    <div class="pdf-row">
                        <span class="pdf-label">Annual Revenue</span>
                        <span class="pdf-value" id="pdf-revenue">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Operating Expenses</span>
                        <span class="pdf-value negative" id="pdf-expenses">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">First Position P&I (Annual)</span>
                        <span class="pdf-value negative" id="pdf-first-pi">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Seller Carry (Annual)</span>
                        <span class="pdf-value negative" id="pdf-seller-pi">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Monthly Cash Flow</span>
                        <span class="pdf-value positive" id="pdf-monthly-cf">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">CF to Purchase Price</span>
                        <span class="pdf-value" id="pdf-cf-purchase">0%</span>
                    </div>
                </div>

                <div class="pdf-section">
                    <div class="pdf-section-title">Balloon & Equity Projection</div>
                    <div class="pdf-row">
                        <span class="pdf-label">Years to Balloon</span>
                        <span class="pdf-value" id="pdf-years-balloon">0 years</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Projected Value</span>
                        <span class="pdf-value" id="pdf-value-balloon">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Remaining Balance</span>
                        <span class="pdf-value negative" id="pdf-balance-balloon">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Equity at Balloon</span>
                        <span class="pdf-value positive" id="pdf-equity-balloon">$0</span>
                    </div>
                    <div class="pdf-row">
                        <span class="pdf-label">Equity Percentage</span>
                        <span class="pdf-value highlight" id="pdf-equity-pct">0%</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="pdf-footer">
            This analysis is for informational purposes only. All projections are estimates and actual results may vary.
            <br>Generated by Real Estate Underwriting Calculator
        </div>
    </div>

    <!-- LOI Template -->
    <div id="loi-document">
        <div class="loi-date-header">
            <span id="loi-date"></span>
        </div>

        <div class="loi-address-line">
            <span id="loi-property-address"></span>
            <span class="loi-tracking">LOI TRACKING NUMBER: <span id="loi-tracking"></span></span>
        </div>
        
        <div class="loi-property-link" id="loi-property-link-container"></div>

        <div class="loi-re">
            <strong>Re: Letter of Intent to Purchase Property</strong>
        </div>

        <div class="loi-greeting">
            Dear <span id="loi-seller-name">[Seller Name]</span>,
        </div>

        <div class="loi-body">
            <p>On behalf of <strong>Instant Hotels, Inc.</strong>, we are pleased to present this Letter of Intent expressing our intention to purchase the property located at <strong id="loi-address-inline"></strong> for the proposed purchase price of <strong id="loi-price-inline"></strong>. This Letter of Intent outlines the key terms and conditions of our offer, subject to further negotiations and the execution of a formal purchase contract.</p>

            <h3>Purchase Details:</h3>
            <p><u>Property:</u> <span id="loi-property-full"></span></p>
            <p><u>Proposed Terms Purchase Price:</u> <span id="loi-purchase-price"></span></p>
            <p><strong>Property Condition:</strong> Property to be acquired strictly in its present "As-Is, Where-Is" condition, with no representations or warranties from the Seller.</p>
            
            <p>‚Ä¢ <u>Cash at Closing:</u> <strong id="loi-cash-at-closing"></strong> (Buyer has established lender financing relationships and can deliver without delay).</p>
            
            <p>‚Ä¢ <u>Seller-Equity Agreement:</u> (Finance Agreement): <strong id="loi-seller-equity"></strong>. Amortization: <strong id="loi-amort-years"></strong> years, Monthly Payments: <strong id="loi-monthly-payment"></strong> consisting of principal only with a <strong id="loi-balloon-years"></strong>-year balloon.</p>

            <p><strong>Seller-Equity Agreement:</strong> Simultaneously, the Buyer's LLC operating agreement is executed to reflect the Seller's minority equity interest. Escrow returns this portion to the Buyer post-closing, while the Seller retains a secured interest in the LLC for that amount, with rights to assume full ownership of the LLC in the event of default.</p>

            <p>The closing will be facilitated by a licensed title company, escrow agent, or closing attorney (hereby "the Closing Agent"), and all funds will be disbursed at the close of escrow in accordance with mutually agreed-upon instructions contained in a definitive state-approved Purchase and Sale Agreement ("PSA"). The transaction will occur in two distinct stages:</p>

            <h3><u>First Stage (All Cash Closing)</u></h3>
            <p>At the initial all-cash closing, the Buyer will bring the full purchase price in cash. The Buyer intends to obtain a Commercial loan at 70-80% loan-to-value (LTV) to reimburse a portion of the funds following this close. The Purchase and Sale Agreement and its incorporated escrow instructions shall direct the Closing Agent to hold funds in escrow until the second leg of the transaction is completed. The close will be contingent on the Property appraising at or above the agreed-upon purchase price. The Buyer will close escrow, and the title insurer will issue a title policy insuring the Buyer's interest in the Property after this first leg, with all associated title insurance premiums and related closing costs borne by the Buyer.</p>

            <h3><u>Second Stage (Seller-Financing/Installment Sale)</u></h3>
            <p>Following the close of escrow and completion of the first leg, the immediate second leg of the transaction is opened pursuant to detailed escrow instructions in the Purchase and Sale Agreement. The Closing Agent shall disburse the Seller's agreed-upon down payment, and instead of recording a Deed of Trust/Mortgage and Promissory Note, the Seller's remaining equity will be secured through the Buyer's LLC operating agreement, naming the Seller as a minority equity partner. In the event of a default, this structure entitles the Seller to obtain 100% ownership of the LLC, thereby regaining full control of the Property without the need for foreclosure. The Seller-financed portion shall still be structured as an installment sale, providing ongoing, tax-advantaged income while simultaneously reducing the Seller's immediate tax burden. To further protect the Seller's financial interest in the Property, we offer a Seller Protection Clause (please see the bottom of this Section for more details). The title insurer will issue a title policy insuring the Buyer's interest in the Property after this second leg, with all associated title insurance premiums and related closing costs borne by the Buyer.</p>

            <p>This creative structure enables the Buyer to acquire the Property at a comparatively low capitalization rate at retail pricing, while remitting a substantial portion of the Purchase Price to the Seller as an immediate down payment. Concurrently, by structuring the balance as an installment sale with seller financing, the Seller can defer and potentially minimize immediate tax liabilities. The Seller, thus, secures an aggressive purchase price, a significant down payment, and the potential for a reduced overall tax burden.</p>

            <div class="loi-steps-box">
                <h3>Step 1 ‚Äì Seller Agrees to Sell Property</h3>
                <ul>
                    <li>Property Price: <strong id="loi-step1-price"></strong></li>
                    <li>Seller hands over the property in <strong>as-is</strong> condition.</li>
                </ul>

                <h3>Step 2 ‚Äì Stage 1: Cash Closing</h3>
                <ul>
                    <li>Buyer brings <strong id="loi-step2-cash"></strong> cash to closing.</li>
                    <li>Escrow holds funds temporarily.</li>
                    <li>Title transfers ‚Üí Buyer's LLC now owns the property.</li>
                    <li>Seller gets their immediate cash payout: <strong id="loi-step2-payout"></strong>.</li>
                </ul>

                <h3>Step 3 ‚Äì Stage 2: Equity Carry Agreement</h3>
                <ul>
                    <li>The remaining <strong id="loi-step3-remaining"></strong> is not paid out in cash.</li>
                    <li>Instead, it becomes the Seller's <strong>Equity Carry (preferred equity)</strong> inside Buyer's LLC.</li>
                </ul>

                <h3>Step 4 ‚Äì Seller's Equity Terms</h3>
                <ul>
                    <li>Treated like a <strong>secured loan inside the new LLC</strong>.</li>
                    <li>Monthly payment: <strong id="loi-step4-payment"></strong> (principal only).</li>
                    <li>Balloon: <strong id="loi-step4-balloon"></strong> years.</li>
                    <li>If Buyer defaults ‚Üí Seller can <strong>take back 100% of the LLC</strong> (full ownership of property) without foreclosure.</li>
                </ul>

                <h3>Step 5 ‚Äì Seller's Benefits</h3>
                <ul class="loi-benefits">
                    <li>‚úÖ Immediate cash at close (<strong id="loi-step5-cash"></strong>)</li>
                    <li>‚úÖ Ongoing monthly payments (<strong id="loi-step5-payment"></strong>)</li>
                    <li>‚úÖ Secured "back door" ownership protection</li>
                    <li>‚úÖ Tax-advantaged structure (installment sale)</li>
                </ul>
            </div>

            <p>In accordance with guidance set forth by the Internal Revenue Service (IRS) for installment sales (see, e.g., IRS Publication 537), "income received over time through an installment sale may, under certain circumstances, be treated as ordinary income." This approach allows for the recognition of gains and the associated tax obligations to be spread over multiple tax years, rather than realized in a single lump sum, potentially resulting in a more favorable tax outcome.</p>

            <p>Additionally, the buyer will cover all title insurance premiums, all customary closing costs, fees, and related expenses. This allocation ensures the Seller realizes the full benefit of the agreed-upon financial terms without incurring out-of-pocket transactional costs.</p>

            <p>This LOI is provided solely as an outline and for the purpose of facilitating further discussion. Except as may be otherwise agreed in writing (such as confidentiality or exclusivity provisions), this LOI is non-binding. Neither Party shall be legally obligated to proceed unless and until both Parties execute a definitive State-approved PSA and related ancillary documents that fully memorialize the terms and conditions of the transaction.</p>

            <h3><u>Seller Protection Clause</u></h3>
            <p style="text-align: center;"><strong>Operating Agreement with Default Control Provisions</strong></p>
            <ul>
                <li><strong>Instead of holding a second-position lien, the Seller and Buyer will enter into an LLC operating agreement (or land trust with an assignment of beneficial interest) where the Seller maintains certain minority equity interest.</strong></li>
                <li><strong>The LLC or trust holds title to the property, and the Buyer operates as the primary manager/member.</strong></li>
                <li><strong>The agreement includes a clause that allows the Seller to regain full control of the LLC or trust (and thus the property) if the Buyer defaults on their financial obligations (missed payments, failure to insure, etc.).</strong></li>
            </ul>

            <p><u>Commissions:</u> 2.5% to Buyer's Agent, Steven Glaude, LPT Realty, Lic #01257750.</p>

            <p><u>Deposit:</u> EMD is 1% of purchase price, deposited after inspection period.</p>

            <p><u>Inspection Period:</u> Buyer shall have a maximum of thirty (30) business days following execution of the PSA to complete all due diligence, including inspections, title review, and feasibility studies. The inspection period only begins after the buyer receives all financials relevant to the business operation. The buyer is prepared to accelerate this if feasible. The Earnest Money Deposit goes hard at 1% after the inspection contingency period.</p>

            <p><strong>Provision of Financial and Operational Documentation:</strong> The Seller agrees to furnish the Buyer, within a specified due diligence period, with complete and accurate financial and operational records relating to the Property. Such records shall include, but are not limited to:</p>
            <ul class="loi-docs-list">
                <li><strong>Trailing Twelve (T12) Months Operating Statements:</strong> Detailed income and expense reports for the previous twelve (12) months.</li>
                <li><strong>Rent Roll and Leases:</strong> Current rent roll listing all tenants, rental amounts, security deposits, lease start and end dates, and any tenant concessions. Copies of all existing tenant leases, amendments, and related agreements (including any side letters or guaranties) shall be provided.</li>
                <li><strong>Service and Vendor Contracts:</strong> Copies of all service agreements, property management contracts, warranties, guaranties, or other third-party obligations that the Buyer would assume or be subject to post-closing.</li>
                <li><strong>Utility and Maintenance Records:</strong> Historical utility bills, maintenance logs, capital expenditure records, and warranty information for major systems (HVAC, roof, mechanicals, elevators, if applicable).</li>
                <li><strong>Insurance and Claims History:</strong> Certificates of insurance, loss runs, and any claims history that may impact future insurance premiums or coverage availability.</li>
                <li><strong>Tax and Assessment Information:</strong> Most recent property tax statements, assessments, and notices of any special assessments or pending reassessments.</li>
                <li><strong>Permits and Licenses:</strong> Copies of all governmental permits, licenses, or approvals necessary for the current operation of the Property, including any evidence of compliance with zoning, building codes, fire and life safety regulations, and other applicable laws.</li>
            </ul>

            <p><u>Closing Date:</u> Closing to occur within <strong>forty-five (45) to sixty (60) days</strong> or sooner following full execution of the Agreement. The buyer is positioned to close earlier if conditions permit. A one-time extension of 15 days may be granted upon mutual agreement.</p>

            <p><u>Closing Costs:</u> Buyer will assume all standard closing costs, including escrow fees, title insurance premiums, recording fees, transfer taxes, and other customary expenses, thereby ensuring a streamlined closing process for Seller. Commitment to Transaction: Buyer is a capable and well-capitalized purchaser, seeking a straightforward and expeditious transaction. The terms outlined above are designed to provide Seller with a clean, competitive, and dependable closing, minimizing risk and delay.</p>

            <h3>Contingencies to Closing:</h3>
            <p>a. Property Inspections: Buyer shall inspect all buildings, grounds, utilities and clean environmental.</p>
            <p>b. Lending, Appraisal, and Financing.</p>
            <p>c. Review documentation and verify title, check for delinquent utilities, and review current payment statements.</p>

            <h3>Conditions:</h3>
            <p>The execution of an Agreement of Sale shall be conditioned on the satisfaction of the above terms and contingencies. Both Purchaser and Seller acknowledge that this Letter of Intent is not a purchase contract but serves as the foundation for drafting a formal purchase contract between the parties. No legal obligations or liabilities shall arise from this Letter of Intent.</p>

            <p><strong>Instant Hotels, Inc.</strong>, makes no warranty or representation to Seller or Purchaser that the acceptance of this Letter of Intent guarantees the execution of a purchase contract.</p>

            <p>This Letter of Intent is valid until <strong>5:00 PM</strong> on <strong id="loi-expiry-date"></strong>. If an executed copy of this letter is not received by that date, this Letter of Intent will be considered withdrawn.</p>

            <p>We look forward to further discussions and negotiations to reach a mutually beneficial agreement. Please do not hesitate to contact us to initiate the next steps in this process.</p>

            <p>Sincerely,</p>

            <div class="loi-signature-section">
                <div class="loi-sig-left">
                    <p><strong id="loi-sig-name"></strong></p>
                    <p>Acquisitions Manager,</p>
                    <p>Instant Hotels, Inc</p>
                    <p id="loi-sig-email"></p>
                    <p id="loi-sig-phone"></p>
                    <br>
                    <p><strong>Steven P. Glaude</strong></p>
                    <p><em>President</em></p>
                    <p>Realtor ~ Investor</p>
                    <p>CalBRE #01257750</p>
                    <p>Tel. No. (916) 316-4472</p>
                    <p><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d8abacbdaebdb698bdb9aba1b9a8b9aaacb5bdb6acabbaada1bdaaf6bbb7b5">[email&#160;protected]</a></p>
                    <p>www.stevenglaude.com</p>
                    <p>https://equitycarrygroup.com/</p>
                </div>
            </div>

            <div class="loi-acceptance">
                <div class="loi-signature-row">
                    <div class="loi-sig-date">
                        <span id="loi-accept-date"></span>
                    </div>
                    <div class="loi-sig-content">
                        <p class="loi-sig-by">By: <span class="steven-signature">Steven Glaude</span></p>
                        <p class="loi-sig-label">Buyer: Instant Hotels, Inc.</p>
                    </div>
                </div>

                <h3 class="loi-accept-title">ACCEPTANCE THIS DATE:</h3>
                
                <div class="loi-signature-row">
                    <div class="loi-sig-date">
                        <span class="loi-blank-line">_____________________</span>
                    </div>
                    <div class="loi-sig-content">
                        <p class="loi-sig-by">By: _________________________________</p>
                        <p class="loi-sig-label"><strong>Seller:</strong> <span id="loi-seller-sig-name"></span></p>
                        <p class="loi-sig-detail" id="loi-seller-sig-email"></p>
                        <p class="loi-sig-detail" id="loi-seller-sig-phone"></p>
                    </div>
                </div>
            </div>
